(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{123:function(e,t,a){e.exports=a(312)},128:function(e,t,a){},130:function(e,t,a){},312:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(38),u=a.n(s),c=(a(128),a(17)),i=a(18),o=a(27),l=a(26),m=a(28),p=(a(130),a(121)),d=a.n(p),f=a(122),h=a.n(f),v=a(74),g=a.n(v),b=a(56),y=a.n(b),j=function(e){return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"content"},"Dashboard"),n.a.createElement("div",{className:"footer"}),n.a.createElement(y.a,{url:"/ws",topics:["/topic/job"],onConnect:function(){console.log("CONNECTED!!!")},onMessage:function(e){console.log(e)}}))},_=a(3),E=a.n(_),O=a(9),k=a(4),M=a(120),N=a.n(M),S=a(30),w=a.n(S),I=a(73),L=a.n(I),x=function(e){function t(){return Object(c.a)(this,t),Object(o.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props.measuresList;return n.a.createElement("div",{className:"measure-list","data-testid":"measure-list"},n.a.createElement(w.a,{onClick:Object(O.a)(E.a.mark(function t(){return E.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.addMeasure();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))},"+ Measure"),t&&t.sort().map(function(t){var a=t.measureId,r=t.measureName,s=t.selected,u=t.jobStatus;return n.a.createElement("li",{key:a,"data-testid":"measure-id-".concat(a),className:s?"selected":"",onClick:function(t){e.props.getMeasure(a),e.props.selectMeasure(a,t)}},n.a.createElement("span",null,r),0===t.progress&&n.a.createElement(L.a,{className:"circular-progress ".concat(u||"IDLE")}),0!==t.progress&&n.a.createElement(L.a,{className:"circular-progress ".concat(u||"IDLE"),variant:"determinate",value:"RUNNING"===u?t.progress:100}))}))}}]),t}(r.Component),C=a(11),R=a.n(C),P=a(119),D=a.n(P),T=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(o.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(n)))).state={changeRule:a.changeRule.bind(Object(k.a)(Object(k.a)(a))),changeId:a.changeId.bind(Object(k.a)(Object(k.a)(a))),changeParam:a.changeParam.bind(Object(k.a)(Object(k.a)(a)))},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props.item,a=t.step,r=t.rules,s=t.deleteStep,u=this.props,c=u.itemSelected,i=u.dragHandle,o=.05*c+1,l=15*c+1,m=0!==c;return n.a.createElement("div",{className:R()("step",{dragged:m}),style:{transform:"scale(".concat(o,")"),boxShadow:"rgba(0, 0, 0, 0.3) 0px ".concat(l,"px ").concat(2*l,"px 0px")}},i(n.a.createElement("div",{className:"dragHandle"})),n.a.createElement("input",{type:"text",defaultValue:a.stepId,onChange:function(t){e.changeId(t,"stepId")}}),n.a.createElement("select",{value:a.ruleName,onChange:function(t){return e.changeRule(t)}},r.map(function(e){return n.a.createElement("option",{key:e}," ",e," ")})),n.a.createElement("input",{type:"text",defaultValue:a.successStepId,onChange:function(t){e.changeId(t,"successStepId")}}),n.a.createElement("input",{type:"text",defaultValue:a.failureStepId,onChange:function(t){e.changeId(t,"failureStepId")}}),n.a.createElement(D.a,{className:"delete-step-icon",onClick:function(){s(a.id)}}),n.a.createElement("div",{className:"parameters"},a.parameters.map(function(t,a){return n.a.createElement("div",{key:t.ruleParamId,className:"param-editor"},n.a.createElement("div",{className:"param-name"},t.paramName),n.a.createElement("input",{className:"param-value",type:"text",defaultValue:t.paramValue,placeholder:e._getPlaceHolder(t),onChange:function(t){return e.changeParam(t,a)}}))})))}},{key:"changeRule",value:function(e){var t=this.props.item,a=t.step,r=t.ruleParams,n=t.onChangeStep;a.ruleName=e.target.value,a.parameters=r.filter(function(t){return t.paramName&&t.ruleName===e.target.value}),n(a)}},{key:"changeId",value:function(e,t){var a=this.props.item,r=a.step,n=a.onChangeStep;r[t]=parseInt(e.target.value),n(r)}},{key:"changeParam",value:function(e,t){var a=this.props.item,r=a.step,n=a.onChangeStep;r.parameters[t].paramValue=e.target.value,n(r)}},{key:"getDragHeight",value:function(){return 30}},{key:"_getPlaceHolder",value:function(e){return"DATE"===e.paramType?"YYYYMMDD":"INTEGER"===e.paramType?"###":void 0}}]),t}(r.Component),V=function(){return Math.floor(1e3*Math.random())+1},J=function(e,t){return e.measureName<t.measureName?-1:e.measureName>t.measureName?1:0},U={"Content-Type":"application/json"};var A=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(o.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(n)))).state={ruleParams:[],measureList:[],measure:null,_changeStep:a._changeStep.bind(Object(k.a)(Object(k.a)(a))),_changeName:a._changeName.bind(Object(k.a)(Object(k.a)(a))),_changeDescription:a._changeDescription.bind(Object(k.a)(Object(k.a)(a))),_stepReorder:a._stepReorder.bind(Object(k.a)(Object(k.a)(a))),_addMeasure:a._addMeasure.bind(Object(k.a)(Object(k.a)(a))),_deleteMeasures:a._deleteMeasures.bind(Object(k.a)(Object(k.a)(a))),_saveMeasure:a._saveMeasure.bind(Object(k.a)(Object(k.a)(a))),_selectMeasure:a._selectMeasure.bind(Object(k.a)(Object(k.a)(a))),_processMeasures:a._processMeasures.bind(Object(k.a)(Object(k.a)(a)))},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=Object(O.a)(E.a.mark(function e(){var t,a;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.measureRepository._findAllRuleParams();case 2:return t=e.sent,e.next=5,this.props.measureRepository._findAllMeasureListItems();case 5:a=e.sent,this.setState({ruleParams:t,measureList:a});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t=this,a=this.state,r=a.measure,s=a.ruleParams,u=a.measureList,c=this._getUniqueRuleNames(s),i=r&&r.measureLogic&&r.measureLogic.steps;return i&&(e=r.measureLogic.steps.map(function(e,a){return{step:e,rules:c,index:a,ruleParams:s,key:e.id,onChangeStep:t._changeStep(),deleteStep:t._deleteStep()}})),n.a.createElement(n.a.Fragment,null,n.a.createElement("form",{className:"content measure-editor"},n.a.createElement(x,{measuresList:u,getMeasure:this._getMeasure(),selectMeasure:this._selectMeasure(),selectedMeasureId:r?r.measureId:null,addMeasure:this._addMeasure()}),n.a.createElement("div",{className:"measure","data-testid":"measure"},r&&n.a.createElement(n.a.Fragment,null,n.a.createElement("input",{className:"measure-name",type:"text","data-testid":"measure-name",value:r.measureName,onChange:function(e){return t._changeName(e)}}),n.a.createElement("textarea",{className:"measure-description",value:r.measureLogic.description,onChange:function(e){return t._changeDescription(e)}}),n.a.createElement(w.a,{onClick:Object(O.a)(E.a.mark(function e(){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._addStep(c);case 2:case"end":return e.stop()}},e,this)}))},"+ Step")),n.a.createElement("div",null,i&&n.a.createElement(N.a,{itemKey:"key",template:T,list:e,onMoveEnd:function(e,a,r,n){t._stepReorder(e,a,r,n)},container:function(){return document.body}}))),n.a.createElement("div",{className:"footer"},r&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"footer-left-section"},n.a.createElement("p",null,"Last Updated: ".concat(r.lastUpdated)),n.a.createElement("p",null,"Minimum System Version: ".concat(r.measureLogic.minimumSystemVersion))),n.a.createElement("div",{className:"footer-right-section"},n.a.createElement(w.a,{variant:"contained",onClick:function(){return t._saveMeasure()}},"Save"),n.a.createElement(w.a,{variant:"contained",color:"secondary",onClick:function(){return t._deleteMeasures()}},"Delete"),n.a.createElement(w.a,{variant:"contained",color:"primary",onClick:function(){return t._processMeasures()}},"Process"))))),n.a.createElement(y.a,{url:"/ws",topics:["/topic/job"],onMessage:function(e){console.log(e);var a=t.state.measureList;a.map(function(t){return e.measureIds.includes(t.measureId)&&(t.progress=e.progress,t.jobStatus=e.jobStatus,t.jobLastUpdated=e.lastUpdated),t}),t.setState({measureList:a})}}))}},{key:"_changeName",value:function(e){var t=this.state.measure;t.measureName=e.target.value,this.setState({measure:t})}},{key:"_changeDescription",value:function(e){var t=this.state.measure;t.measureLogic.description=e.target.value,this.setState({measure:t})}},{key:"_changeStep",value:function(){var e=this;return function(t){var a=e.state.measure;a.measureLogic.steps[t.index]=t,e.setState({measure:a}),e.forceUpdate()}}},{key:"_stepReorder",value:function(e,t,a,r){var n=this.state.measure;n.measureLogic.steps=e.map(function(e){return JSON.parse(JSON.stringify(e.step))}),this.setState({measure:n})}},{key:"_addStep",value:function(e){var t=this.state.measure;t.measureLogic.steps||(t.measureLogic.steps=[]),t.measureLogic.steps.push({rules:e,id:V(),ruleName:"(select)",parameters:[],stepId:0,successStepId:0,failureStepId:0}),this.setState({measure:t})}},{key:"_getMeasure",value:function(){var e=this;return function(){var t=Object(O.a)(E.a.mark(function t(a){var r;return E.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.measureRepository._findById(a);case 2:r=t.sent,e.setState({measure:r});case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}},{key:"_selectMeasure",value:function(){var e=this;return function(t,a){var r=e.state.measureList;a.shiftKey||a.ctrlKey?r.map(function(a){return e._selectMeasureById(a,t)}):(r.map(function(e){return e.selected=!1}),r.map(function(a){return e._selectMeasureById(a,t)})),e.setState({measureList:r})}}},{key:"_selectMeasureById",value:function(e,t){e.measureId===t&&(e.selected=!0)}},{key:"_getUniqueRuleNames",value:function(e){var t=["(select)"];return e.forEach(function(e){return t.push(e.ruleName)}),function(e){for(var t={},a=[],r=0,n=e.length;r<n;++r)t.hasOwnProperty(e[r])||(a.push(e[r]),t[e[r]]=1);return a}(t).sort()}},{key:"_addMeasure",value:function(){var e=this,t={measureId:-1,measureName:"New Measure",measureLogic:{description:"Describe..."}};return Object(O.a)(E.a.mark(function a(){var r,n;return E.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.props.measureRepository._saveMeasure(t);case 2:r=a.sent,(n=e.state.measureList).push({measureId:r.measureId,measureName:r.measureName,jobStatus:"IDLE"}),n.sort(J),e.setState({measure:r,measureList:n});case 7:case"end":return a.stop()}},a,this)}))}},{key:"_saveMeasure",value:function(){var e=Object(O.a)(E.a.mark(function e(){var t,a,r=this;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.measureRepository._saveMeasure(this.state.measure);case 2:return t=e.sent,e.next=5,this.props.measureRepository._findAllMeasureListItems();case 5:return(a=e.sent).map(function(e){return r._selectMeasureById(e,t.measureId)}),this.setState({measure:t,measureList:a}),e.abrupt("return",t);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_processMeasures",value:function(){var e=Object(O.a)(E.a.mark(function e(){var t,a;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._getSelectedMeasures(),e.next=3,this.props.measureRepository._processMeasures(t);case 3:a=this.state.measureList.map(function(e){return t.includes(e.measureId)?(e.jobStatus="RUNNING",e.selected=!1,e):e}),this.setState({measureList:a,measure:null});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_deleteMeasures",value:function(){var e=Object(O.a)(E.a.mark(function e(){var t,a;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._getSelectedMeasures(),e.next=3,this.props.measureRepository._deleteMeasures(t);case 3:a=this.state.measureList.filter(function(e){return!t.includes(e.measureId)}),this.setState({measureList:a,measure:null});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_deleteStep",value:function(){var e=this;return function(t){var a=e.state.measure.measureLogic.steps.filter(function(e){return e.id!==t}),r=e.state.measure;r.measureLogic.steps=a,e.setState({measure:r})}}},{key:"_getSelectedMeasures",value:function(){var e=[];return this.state.measureList.forEach(function(t){t.selected&&e.push(t.measureId)}),e}}]),t}(r.Component),B=function(){function e(){Object(c.a)(this,e)}return Object(i.a)(e,[{key:"_deleteMeasures",value:function(){var e=Object(O.a)(E.a.mark(function e(t){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:fetch("/measure",{headers:U,method:"DELETE",body:JSON.stringify(t)}).catch(function(e){return console.error(e)});case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_findAllRuleParams",value:function(){var e=Object(O.a)(E.a.mark(function e(){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("/rules_params").then(function(e){return e.json()}).catch(function(e){return console.error(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_findAllMeasureListItems",value:function(){var e=Object(O.a)(E.a.mark(function e(){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("/measure_list").then(function(e){return e.json()}).catch(function(e){return console.error(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_processMeasures",value:function(){var e=Object(O.a)(E.a.mark(function e(t){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("/process",{headers:U,method:"POST",body:JSON.stringify(t)}).catch(function(e){return console.error(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_saveMeasure",value:function(){var e=Object(O.a)(E.a.mark(function e(t){var a=this;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/measure",{headers:U,method:"PUT",body:JSON.stringify(t)}).then(function(e){return e.json()}).then(function(e){return a._formatMeasureJson(e)}).catch(function(e){return console.error(e)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_findById",value:function(){var e=Object(O.a)(E.a.mark(function e(t){var a=this;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/measure?measureId=".concat(t)).then(function(e){return e.json()}).then(function(e){return a._formatMeasureJson(e)}).catch(function(e){return console.error(e)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_formatMeasureJson",value:function(e){return e.measureLogic.steps?(e.measureLogic.steps.map(function(e){return e.id=V(),e.parameters&&e.parameters.map(function(e){return e.ruleParamId||(e.ruleParamId=V()),e}),e}),e):e}}]),e}(),H=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(o.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(n)))).state={currentTabValue:1},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"container"},n.a.createElement("nav",{"data-testid":"navigation"},n.a.createElement(d.a,null,n.a.createElement(h.a,{classes:{root:"navigation"},"data-testid":"navigation",value:this.state.currentTabValue,onChange:function(t,a){e.setState({currentTabValue:a})}},n.a.createElement(g.a,{"data-testid":"dashboard",label:"Dashboard"}),n.a.createElement(g.a,{"data-testid":"measure-editor",label:"Measure Editor"})))),n.a.createElement("div",{className:"content","data-testid":"content"},function(){switch(e.state.currentTabValue){case 0:return n.a.createElement(j,null);case 1:return n.a.createElement(A,{measureRepository:new B});default:return n.a.createElement(j,null)}}()))}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(310);u.a.render(n.a.createElement(H,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[123,2,1]]]);
//# sourceMappingURL=main.f9679173.chunk.js.map